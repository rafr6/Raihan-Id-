<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <title>Code128 Barcode Generator (HD Quality)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; max-width: 480px; margin: auto; background: #f7f7f7; color: #111; }
    label { display:block; margin-top:10px; font-weight:600; }
    input[type="text"], input[type="number"] { width:100%; padding:8px; box-sizing:border-box; margin-top:6px; }
    .row { display:flex; gap:8px; margin-top:10px; }
    .row > * { flex:1; }
    button { margin-top:10px; padding:10px 12px; cursor:pointer; border:none; background:#0b79d0; color:white; border-radius:6px; font-weight:bold; }
    #barcodeWrap { margin-top:18px; background:white; padding:18px; border-radius:8px; text-align:center; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
    #svgContainer { display:inline-block; }
    small { color:#555; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>
<body>
  <h2>Code 128 বারকোড (HD Quality) — JPG/PNG ডাউনলোড</h2>

  <label>URL</label>
  <input id="urlInput" type="text" value="https://rafr6.github.io/Brta-Licence-verification-/" />

  <div class="row">
    <div>
      <label>প্রস্থ (mm)</label>
      <input id="widthMm" type="number" value="54" min="30" />
    </div>
    <div>
      <label>উচ্চতা (mm)</label>
      <input id="heightMm" type="number" value="17" min="8" />
    </div>
    <div>
      <label>DPI</label>
      <input id="dpi" type="number" value="300" min="72" />
    </div>
  </div>

  <button id="generateBtn">Generate</button>

  <div id="barcodeWrap">
    <div id="svgContainer">
      <svg id="barcodeSvg"></svg>
    </div>
    <div style="margin-top:12px;">
      <button id="downloadPng">Download PNG</button>
      <button id="downloadJpg">Download JPG</button>
      <p><small>অথবা রাইট-ক্লিক → Save image as...</small></p>
    </div>
  </div>

<script>
function mmToPx(mm, dpi) {
  return Math.round((mm / 25.4) * dpi);
}

function generateBarcode() {
  const url = document.getElementById('urlInput').value.trim();
  if (!url) { alert('URL দিন।'); return; }

  const widthMm = parseFloat(document.getElementById('widthMm').value) || 54;
  const heightMm = parseFloat(document.getElementById('heightMm').value) || 17;
  const dpi = parseInt(document.getElementById('dpi').value) || 300;

  const targetW = mmToPx(widthMm, dpi);
  const targetH = mmToPx(heightMm, dpi);

  const svg = document.getElementById('barcodeSvg');
  svg.setAttribute("width", targetW);
  svg.setAttribute("height", targetH);

  const barWidth = Math.max(1, targetW / 200); 

  JsBarcode(svg, url, {
    format: "CODE128",
    lineColor: "#000",
    width: barWidth,
    height: targetH,
    displayValue: false,
    margin: 0
  });

  svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
}

function downloadBarcode(type) {
  const dpi = parseInt(document.getElementById('dpi').value) || 300;
  const widthMm = parseFloat(document.getElementById('widthMm').value) || 54;
  const heightMm = parseFloat(document.getElementById('heightMm').value) || 17;

  // স্কেল বাড়িয়ে HD ইমেজ
  const scale = 4;
  const targetW = mmToPx(widthMm, dpi) * scale;
  const targetH = mmToPx(heightMm, dpi) * scale;

  const svg = document.getElementById('barcodeSvg');
  const serializer = new XMLSerializer();
  let svgStr = serializer.serializeToString(svg);

  const svgBase64 = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgStr)));

  const img = new Image();
  img.onload = () => {
    const canvas = document.createElement('canvas');
    canvas.width = targetW;
    canvas.height = targetH;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // HD Quality আঁকা
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const dataUrl = canvas.toDataURL(type === 'png' ? 'image/png' : 'image/jpeg', 1.0);
    const a = document.createElement('a');
    a.href = dataUrl;
    a.download = type === 'png' ? 'barcode.png' : 'barcode.jpg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  };
  img.src = svgBase64;
}

document.getElementById('generateBtn').addEventListener('click', generateBarcode);
document.getElementById('downloadPng').addEventListener('click', () => downloadBarcode('png'));
document.getElementById('downloadJpg').addEventListener('click', () => downloadBarcode('jpg'));
window.addEventListener('load', generateBarcode);
</script>
</body>
</html>
